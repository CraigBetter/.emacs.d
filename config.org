#+TITLE: Emacs Configuration
#+AUTHOR: Craig Best
* set variables to preserve sanity
TODO: split this up into sections
#+begin_src emacs-lisp :tangle yes
(setq make-backup-files nil) ; stop creating backup~ files, link: http://ergoemacs.org/emacs/emacs_set_backup_into_a_directory.html
(setq auto-save-default nil) ; stop creating #autosave# files

(setq auto-save-default nil) ;; sanity
(savehist-mode 0)  ;; sanity

(setq inhibit-splash-screen 1)
(scroll-bar-mode 0)
(tool-bar-mode 0)
(menu-bar-mode 0)

(global-display-line-numbers-mode)
;(setq display-line-numbers 'relative)

;(global-unset-key (kbd "C-x C-c"))

;(setq gc-cons-threshold 100000000)

; https://emacs.stackexchange.com/questions/22499/how-can-i-tell-emacs-to-always-open-help-buffers-in-the-current-window
; open help windows in buffer they were invoked from
;; (add-to-list 'display-buffer-alist
;;              '("*Help*" display-buffer-same-window))

;; make cursor blink forever in GUI
(setq blink-cursor-blinks 0)

;; for some bullshit reason C-, doesn't register in a tty or in the kitty terminal
;; and a cursory googling reveals no results. GET TO THE BOTTOM OF THIS!!!!
(define-key org-mode-map (kbd "C-c C-,") nil)
(define-key org-mode-map (kbd "C-c ,") 'org-insert-structure-template)

; taken from: https://gitlab.haskell.org/ghc/ghc/-/wikis/emacs
(setq-default indent-tabs-mode nil)
#+end_src

* set up melpa
  #+begin_src emacs-lisp :tangle yes
  (require 'package)
  (add-to-list 'package-archives '("melpa" . "http://melpa.org/packages/"))
  (package-initialize)
  (when (not package-archive-contents)
      (package-refresh-contents))
  #+end_src

* use-package
#+begin_src emacs-lisp :tangle yes
;;(package-install 'use-package)
(if (not (package-installed-p 'use-package))
	 (package-install 'use-package))
#+end_src

* undo-tree
  #+begin_src emacs-lisp :tangle yes
  (use-package undo-tree
    :ensure t
    :config
    (global-undo-tree-mode))
  #+end_src

* evil-mode
** main
  link for :init code https://stackoverflow.com/questions/22878668/emacs-org-mode-evil-mode-tab-key-not-working
  ^that solves the problem where org-cycle is not bound to tab in evil-mode in a terminal
  #+begin_src emacs-lisp :tangle yes
  (use-package evil
    :ensure t
    :init   ;; run before loading evil-mode
    (setq evil-want-C-i-jump nil) ;; this doesn't work the first time
                                  ;; emacs is run, ie when emacs downloads this package
    (setq evil-undo-system 'undo-tree) ;; am I supposed to quote here?
    (setq evil-want-C-u-scroll t)
    :config ;; run after loading evil-mode
    (evil-mode 1))
  #+end_src
  
** evil-terminal-cursor-changer
   #+begin_src emacs-lisp :tangle yes
   (use-package evil-terminal-cursor-changer
     :ensure t
     :config
     (unless (display-graphic-p) ;only do when running in terminal
       (require 'evil-terminal-cursor-changer)
       (evil-terminal-cursor-changer-activate) ; or (etcc-on)
       (setq evil-motion-state-cursor 'box)  ; █
       (setq evil-visual-state-cursor 'box)  ; █
       (setq evil-normal-state-cursor 'box)  ; █
       (setq evil-insert-state-cursor 'bar)  ; ⎸
       (setq evil-emacs-state-cursor  'hbar)
       (setq evil-operator-state-cursor  'hbar))) ; _ ;why doesn't this one work?
   #+end_src
   
** evil esc quit
   taken from here: https://stackoverflow.com/questions/8483182/evil-mode-best-practice
   originally taken from here: https://github.com/davvil/.emacs.d/blob/master/init.el
   #+begin_src emacs-lisp :tangle yes
   ;;; esc quits
   (defun minibuffer-keyboard-quit ()
     "Abort recursive edit.
   In Delete Selection mode, if the mark is active, just deactivate it;
   then it takes a second \\[keyboard-quit] to abort the minibuffer."
     (interactive)
     (if (and delete-selection-mode transient-mark-mode mark-active)
         (setq deactivate-mark  t)
       (when (get-buffer "*Completions*") (delete-windows-on "*Completions*"))
       (abort-recursive-edit)))
   (define-key evil-normal-state-map [escape] 'keyboard-quit)
   (define-key evil-visual-state-map [escape] 'keyboard-quit)
   (define-key minibuffer-local-map [escape] 'minibuffer-keyboard-quit)
   (define-key minibuffer-local-ns-map [escape] 'minibuffer-keyboard-quit)
   (define-key minibuffer-local-completion-map [escape] 'minibuffer-keyboard-quit)
   (define-key minibuffer-local-must-match-map [escape] 'minibuffer-keyboard-quit)
   (define-key minibuffer-local-isearch-map [escape] 'minibuffer-keyboard-quit)
   #+end_src

** evil-numbers
   #+begin_src emacs-lisp :tangle yes
   (use-package evil-numbers
     :ensure t
     :config
     (define-key evil-normal-state-map (kbd "+") 'evil-numbers/inc-at-pt)
     (define-key evil-normal-state-map (kbd "-") 'evil-numbers/dec-at-pt)
     (define-key evil-visual-state-map (kbd "+") 'evil-numbers/inc-at-pt)
     (define-key evil-visual-state-map (kbd "-") 'evil-numbers/dec-at-pt))
   #+end_src
* theme
  make background colorless when in terminal
  https://stackoverflow.com/questions/19054228/emacs-disable-theme-background-color-in-terminal
  #+begin_src emacs-lisp :tangle yes
  (use-package doom-themes
  :ensure t
  :config (load-theme 'doom-Iosvkem t)
  (unless (display-graphic-p)
    (set-face-background 'default "unspecified-bg")))
  #+end_src
  + errors
    Warning (bytecomp): the following functions are not known to be defined:
        all-the-icons-dir-is-submodule, all-the-icons-octicon,
        all-the-icons-octicon-family, all-the-icons-icon-for-file,
        all-the-icons-fileicon, neo-path--file-short-name,
        neo-vc-for-node, neo-buffer--insert-fold-symbol,
        neo-buffer--node-list-set, neo-buffer--newline-and-begin,
        neo-global--select-window, neo-buffer--insert-file-entry,
        neo-buffer--insert-dir-entry, neo-buffer--insert-root-entry
* completion
** icomplete-vertical
   #+begin_src emacs-lisp :tangle no
   (use-package icomplete-vertical
     :ensure t
     :demand t
     :custom
     (completion-styles '(partial-completion substring))
     (completion-category-overrides '((file (styles basic substring))))
     (read-file-name-completion-ignore-case t)
     (read-buffer-completion-ignore-case t)
     (completion-ignore-case t)
     :config
     (icomplete-mode)
     (icomplete-vertical-mode)
     :bind (:map icomplete-minibuffer-map
                 ("<down>" . icomplete-forward-completions)
                 ("C-n" . icomplete-forward-completions)
                 ("<up>" . icomplete-backward-completions)
                 ("C-p" . icomplete-backward-completions)
                 ("C-v" . icomplete-vertical-toggle)))
  #+end_src

** orderless
   links: https://www.reddit.com/r/emacs/comments/g6ocid/orderless_a_completion_style_that_matches/
          https://github.com/oantolin/orderless
   #+begin_src emacs-lisp :tangle no
   (use-package orderless
     :ensure t
     :init (icomplete-mode) ; optional but recommended!
     :custom (completion-styles '(orderless)))
   #+end_src

** Ido
   #+begin_src emacs-lisp :tangle no
   (ido-mode)
   #+end_src

** TODO which-key

** selectrum
   doing this in the minibuffer does not yield a buffer full of
   completions
   (global-set-key (kbd "C-x 9") 'minibuffer-complete)
   #+begin_src emacs-lisp :tangle yes
   (use-package selectrum
     :ensure t
     :init
     (use-package selectrum-prescient
       :ensure t)
     :config
     (selectrum-mode +1)
     (selectrum-prescient-mode +1))
   #+end_src

** TODO live-completions?
   + links: 
     https://www.reddit.com/r/emacs/comments/geqgmy/ann_new_package_livecompletions_a_simple/
     https://github.com/oantolin/live-completions
** TODO LSP?
   + links:
     https://www.youtube.com/watch?v=SIzQ0snQJEo
* TODO mode-line
  + links:
    https://github.com/maavelar5/dotemacs/blob/master/.emacs.d/marco-mode.el#L367

* org-mode
** org-babel
   <2020-09-05 Sat>
   https://orgmode.org/worg/org-contrib/babel/languages.html#configure
   bash source blocks https://stackoverflow.com/questions/29163164/how-can-i-load-bash-as-opposed-to-sh-in-org-babel-to-enable-begin-src-bash
 #+begin_src emacs-lisp :tangle yes
 ;; active Babel languages
 (org-babel-do-load-languages
  'org-babel-load-languages
  '((emacs-lisp . t)
    (shell . t))) ;this allows bash to be run in babel src blocks
 #+end_src

** TODO org-mode search

* TODO try straight
  <2020-10-19 Mon>
  or some other emacs package manager
  link: https://github.com/raxod502/straight.el
* languages
** haskell
   #+begin_src emacs-lisp :tangle t
   (use-package haskell-mode
     :ensure t)
   #+end_src

** common-lisp
   #+begin_src emacs-lisp :tangle t
   (use-package slime
     :ensure t
     :config (setq inferior-lisp-program "clisp"))
   #+end_src

* TODO eyebrowse
  #+begin_src emacs-lisp :tangle yes
  (use-package eyebrowse
    :ensure t
    :config ;; I could probably use apply and other macros to shorten this
    (define-key evil-normal-state-map (kbd "g 0") 'eyebrowse-switch-to-window-config-0) ;; maybe also do this for visual state?
    (define-key evil-normal-state-map (kbd "g 1") 'eyebrowse-switch-to-window-config-1)
    (define-key evil-normal-state-map (kbd "g 2") 'eyebrowse-switch-to-window-config-2)
    (define-key evil-normal-state-map (kbd "g 3") 'eyebrowse-switch-to-window-config-3)
    (define-key evil-normal-state-map (kbd "g 4") 'eyebrowse-switch-to-window-config-4)
    (define-key evil-normal-state-map (kbd "g 5") 'eyebrowse-switch-to-window-config-5)
    (define-key evil-normal-state-map (kbd "g 6") 'eyebrowse-switch-to-window-config-6)
    (define-key evil-normal-state-map (kbd "g 7") 'eyebrowse-switch-to-window-config-7)
    (define-key evil-normal-state-map (kbd "g 8") 'eyebrowse-switch-to-window-config-8)
    (define-key evil-normal-state-map (kbd "g 9") 'eyebrowse-switch-to-window-config-9)
    (setq eyebrowse-new-workspace t)
    (eyebrowse-mode))
  #+end_src
* magit
  #+begin_src emacs-lisp :tangle yes
  (use-package magit
    :ensure t)
  #+end_src

* TODO folding
